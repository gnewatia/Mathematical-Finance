---
title: "Assignment-1"
author: "Gaurja Newatia"
date: "`r Sys.Date()`"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
```

```{r include=FALSE}
library(tidyverse)
library(stringr)
library(readxl)
library(lubridate)
library(ggplot2)
library(broom)
library(knitr)
```

Reading the data and selecting bonds with maturity year less than and equal to 2029
```{r echo=TRUE, message=FALSE, warning=FALSE}
data<-read_excel('MMF-A1.xlsx',sheet = 3)

data<-data|>
  mutate(maturity=paste(Year,str_extract(Bond,"(?<=/)\\d{2}$")),
         coupon=str_extract(Bond, "\\d+(,\\d+)?%"),
         coupon=str_replace(coupon,",","."),
         year_issue=str_extract(Bond,"\\d{2}(?=/)"),
         maturity_year=str_extract(maturity,"\\d+$"),
         maturity=str_replace(maturity,'Sept','September'),
          maturity=str_replace(maturity,'Spet','September'),
         maturity_month=str_extract(maturity,"[[:alpha:]]+"))|>
  select(-Year)|>
  arrange(coupon)


fil<-data|>
  filter(maturity_year<=29)|>
  arrange(maturity_year)



```



```{r echo=TRUE}
fil<-fil |>
  mutate(maturity = paste("01",maturity)) |>
  mutate(maturity_date = as.Date(maturity, format="%d %b %y")) |>
  mutate(start_date = as.Date("2024-01-08")) |>
  mutate(time_remaining = difftime(maturity_date, start_date, units = "days") / 365) |>
  mutate(time_remaining = round(time_remaining, 3))|>
  arrange(time_remaining)
```


```{r}
selected_bonds<-fil|>
  slice(2,7,12,19,23,27,28,32,33,36,37)|>
  pull(Bond)
selected_bonds
```
Getting data for the prices of selected bonds
```{r message=FALSE, warning=FALSE}
bonds<-read_excel('MMF-A1.xlsx',sheet = 2)
```

```{r}
selected_data<-bonds|>
  select(all_of(selected_bonds))|>
  mutate(date=bonds$Date)|>
  slice(n():1)
  
```

```{r message=FALSE, warning=FALSE}
df<-selected_data|>
  select(-date)|>
  t()|>
  as_tibble()

colnames(df)<-selected_data$date
df$Bond_name<-selected_bonds 
```

```{r message=FALSE, warning=FALSE}

last_coupon <- rep("Sep 1 2023",11)

# Convert the vector to Date format
last_coupon_dates <- as.Date(last_coupon, format = "  %b %d %Y")


```

```{r message=FALSE, warning=FALSE}
df["last_coupon"]=last_coupon_dates
```

```{r}
df$day_1<-difftime("2024-01-08",last_coupon_dates,units = "days")
df$day_2<-difftime("2024-01-09",last_coupon_dates,units = "days")
df$day_3<-difftime("2024-01-10",last_coupon_dates,units = "days")
df$day_4<-difftime("2024-01-11",last_coupon_dates,units = "days")
df$day_5<-difftime("2024-01-12",last_coupon_dates,units = "days")
df$day_6<-difftime("2024-01-15",last_coupon_dates,units = "days")
df$day_7<-difftime("2024-01-16",last_coupon_dates,units = "days")
df$day_8<-difftime("2024-01-17",last_coupon_dates,units = "days")
df$day_9<-difftime("2024-01-18",last_coupon_dates,units = "days")
df$day_10<-difftime("2024-01-19",last_coupon_dates,units = "days")
df$day_11<-difftime("2024-01-22",last_coupon_dates,units = "days")
df<-df |>
  mutate(coupon=str_extract(Bond_name, "\\d+(,\\d+)?%"),coupon=str_remove(coupon,"%"), coupon=str_replace(coupon,",","."))|>
  mutate(across(everything(),~str_remove(.x,"days")))|>
  mutate(across(starts_with("day_"),~round(as.numeric(.x),2)))
```

Calculation of Dirty Prices
```{r}
df_notional<-df|>
  mutate(across(starts_with("day_"),
                .fns = ~ round((as.numeric(.x) / 365) * as.numeric(coupon)/100, 3)))

```

```{r message=FALSE, warning=FALSE}
df_dirty_calculations<-df_notional|>
  mutate(across(everything(), ~as.numeric(.x)))|>
select(-coupon,-Bond_name,-last_coupon)
```

```{r message=FALSE, warning=FALSE}
df_dirty_price_calculations<-df_dirty_calculations %>%
  # Ensure all columns are numeric, necessary if operations like division are intended prior to summing
  mutate(across(everything(), ~as.numeric(.x))) %>%
  # Apply rowwise operations to sum specific pairs of columns
  rowwise() %>%
  mutate(
    sum_1 = sum(c_across(c(`8-01-2024`, day_1)), na.rm = TRUE),
    sum_2 = sum(c_across(c(`9-01-2024`, day_2)), na.rm = TRUE),
    sum_3 = sum(c_across(c(`10-01-2024`, day_3)), na.rm = TRUE),
    sum_4 = sum(c_across(c(`11-01-2024`, day_4)), na.rm = TRUE),
    sum_5 = sum(c_across(c(`12-01-2024`, day_5)), na.rm = TRUE),
    sum_6 = sum(c_across(c(`15-01-2024`,day_6)), na.rm = TRUE),  # Assuming weekends are skipped
    sum_7 = sum(c_across(c(`16-01-2024`,day_7)), na.rm = TRUE),
    sum_8 = sum(c_across(c(`17-01-2024`, day_8)), na.rm = TRUE),
    sum_9 = sum(c_across(c(`18-01-2024`, day_9)), na.rm = TRUE),
    sum_10 = sum(c_across(c(`19-01-2024`, day_10)), na.rm = TRUE),
    sum_11 = sum(c_across(c(`22-01-2024`, day_11)), na.rm = TRUE)  # Assuming a gap for weekends or holidays
  ) %>%
  ungroup() |>
  select(sum_1:sum_11)|>
  mutate(across(everything(),~(.x)*100))# Revert to standard evaluation after rowwise operations
```

```{r}
maturity_selected<-fil|>
 filter(Bond %in% selected_bonds)|>
  pull(maturity_date)
```

The final dataset with dirty prices of bonds 

```{r}
final<-tibble(selected_bonds,df_dirty_price_calculations)

dates<-tibble(date=as.Date(c("2024-01-08" ,"2024-01-09","2024-01-10" ,"2024-01-11", "2024-01-12", "2024-01-15", "2024-01-16", "2024-01-17", "2024-01-18" ,"2024-01-19","2024-01-22")))

final<-final|>
  pivot_longer(cols=starts_with("sum_"),names_to = "time_period",values_to = "value")|>
  pivot_wider(names_from = selected_bonds, values_from = value)|>
  add_column(dates)|>

  select(-time_period)
  
```

Calculating Yield to Maturity for each bond for a period of 11 days.

Bond_1

```{r}

Price <- final$`Canada, Government of... 2,25% 18/24`
current_date<-final$date
Coupon <- 2.25/100 # Assuming this is the annual coupon
FaceValue <- 100 # The face value of the bond


Time_years <- function(current_date, maturity_date) {
  as.numeric(difftime(maturity_date, current_date, units = "days")) / 365}
# Define the function to solve for continuous compounding
bond_price_function <- function(r,Price,Time_years) {
  # The present value of the bond's future cash flows (coupon payment and face value) minus the current price
  pv_total <-(((Coupon*FaceValue)/2+FaceValue)*exp(-r*Time_years))-Price          
  return(pv_total)
}

# Use uniroot to solve for r within a reasonable range
yield_solution <- function(Price, current_date) {
  Time_years <- Time_years(current_date, "2024-03-01")
  yield_solution <- uniroot(bond_price_function, lower = 0, upper = 1, Price = Price, Time_years = Time_years)
  return(list(YTM = yield_solution$root, Time_Years = Time_years))}

# The value of r, the yield to maturity
yield_solution_bond1 <- mapply(yield_solution, Price = Price, current_date = current_date)



```
Bond_2
```{r}

Price <- final$`Canada, Government of... 1,5% 19/24`
current_date <- final$date
time_to_maturity_years <- numeric(length(Price))

# YTM results from the first bond
ytm_results_bond_1 <- c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)

# Annual coupon rate
Coupon <- 1.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}


bond_price_function <- function(r, Price_index) {
  
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon = ytm_results_bond_1[Price_index]
  
  Time_years_coupon <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_maturity <- calculate_time_years(current_date_specific, "2024-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon * Time_years_coupon)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond2<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2024-09-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})



```
Bond_3
```{r}
Price <- final$`Canada, Government of... 1,25% 19/25`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)

# Annual coupon rate
Coupon <- 1.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_maturity <- calculate_time_years(current_date_specific, "2025-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond3<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2025-03-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_4
```{r}
Price <- final$`Canada, Government of... 0,5% 20/25`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)

# Annual coupon rate
Coupon <- 0.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_maturity <- calculate_time_years(current_date_specific, "2025-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond4<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2025-09-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```

Bond_5

```{r}
Price <- final$`Canada, Government of... 0,25% 20/26`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)

# Annual coupon rate
Coupon <- 0.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_maturity<- calculate_time_years(current_date_specific, "2026-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond5<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2026-03-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_6
```{r}
Price <- final$`Canada, Government of... 1% 21/26`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)

# Annual coupon rate
Coupon <- 1/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_maturity<- calculate_time_years(current_date_specific, "2026-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond6<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2026-09-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_7

```{r}
Price <- final$`Canada, Government of... 1,25% 21/27`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)
ytm_results_bond_6<-c(0.03516981, 0.03576126, 0.03553197, 0.03559292 ,0.03493524, 0.03517300,0.03609462 ,0.03766520, 0.03772519 ,0.03786977, 0.03778198)

# Annual coupon rate
Coupon <- 1.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
   ytm_for_coupon_6=ytm_results_bond_6[Price_index]
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_coupon_6<- calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2027-03-01")
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_6 * Time_years_coupon_6)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond7<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2027-03-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})



```
Bond_8
```{r}
Price <- final$`Canada, Government of... 2,75% 22/27`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)
ytm_results_bond_6<-c(0.03516981, 0.03576126, 0.03553197, 0.03559292 ,0.03493524, 0.03517300,0.03609462 ,0.03766520, 0.03772519 ,0.03786977, 0.03778198)
ytm_results_bond_7<-c( 0.03486944, 0.03535332, 0.03524677, 0.0349981, 0.0342115,0.03419902 ,0.03506539, 0.03665983, 0.0368167, 0.03692037,0.03666406)
# Annual coupon rate
Coupon <- 2.75/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
   ytm_for_coupon_6=ytm_results_bond_6[Price_index]
   ytm_for_coupon_7=ytm_results_bond_7[Price_index]
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_coupon_6<- calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2027-09-01")
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_6 * Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_7 * Time_years_coupon_7)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond8<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2027-09-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})


```
Bond_9

```{r}
Price <- final$`Canada, Government of... 3,5% 22/28`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)
ytm_results_bond_6<-c(0.03516981, 0.03576126, 0.03553197, 0.03559292 ,0.03493524, 0.03517300,0.03609462 ,0.03766520, 0.03772519 ,0.03786977, 0.03778198)
ytm_results_bond_7<-c( 0.03486944, 0.03535332, 0.03524677, 0.0349981, 0.0342115,0.03419902 ,0.03506539, 0.03665983, 0.0368167, 0.03692037,0.03666406)
ytm_results_bond_8<-c(0.03376291, 0.03426216 ,0.0341593, 0.03437916, 0.03361179,0.03360408 ,0.03448407, 0.03605891, 0.03627013, 0.03614084, 0.03583177)
# Annual coupon rate
Coupon <- 3.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
   ytm_for_coupon_6=ytm_results_bond_6[Price_index]
   ytm_for_coupon_7=ytm_results_bond_7[Price_index]
   ytm_for_coupon_8<-ytm_results_bond_8[Price_index]
   
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_coupon_6<- calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
  Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
   Time_years_maturity<-calculate_time_years(current_date_specific, "2028-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_6 * Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_7 * Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_8 * Time_years_coupon_8)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond9<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2028-03-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})


```
Bond_10
```{r}
Price <- final$`Canada, Government of... 3,25% 23/28`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)
ytm_results_bond_6<-c(0.03516981, 0.03576126, 0.03553197, 0.03559292 ,0.03493524, 0.03517300,0.03609462 ,0.03766520, 0.03772519 ,0.03786977, 0.03778198)
ytm_results_bond_7<-c( 0.03486944, 0.03535332, 0.03524677, 0.0349981, 0.0342115,0.03419902 ,0.03506539, 0.03665983, 0.0368167, 0.03692037,0.03666406)
ytm_results_bond_8<-c(0.03376291, 0.03426216 ,0.0341593, 0.03437916, 0.03361179,0.03360408 ,0.03448407, 0.03605891, 0.03627013, 0.03614084, 0.03583177)
ytm_results_bond_9<-c(0.03308006, 0.03364816, 0.03331507 ,0.03353629, 0.03282015,0.03280074, 0.03368206 ,0.03527576, 0.0355007 ,0.03574624,0.03514695)
# Annual coupon rate
Coupon <- 3.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
   ytm_for_coupon_6=ytm_results_bond_6[Price_index]
   ytm_for_coupon_7=ytm_results_bond_7[Price_index]
   ytm_for_coupon_8<-ytm_results_bond_8[Price_index]
   ytm_for_coupon_9<-ytm_results_bond_9[Price_index]
   
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_coupon_6<- calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
  Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
   Time_years_coupon_9<-calculate_time_years(current_date_specific, "2028-03-01")
   Time_years_maturity<-calculate_time_years(current_date_specific, "2028-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_6 * Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_7 * Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_8 * Time_years_coupon_8)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_9 * Time_years_coupon_9)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond10<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2028-09-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_11
```{r}
Price <- final$`Canada, Government of... 4% 23/29`
current_date <- final$date

# YTM results from the first bond
ytm_results_bond_1<-c(0.04731973, 0.04752944, 0.04774743, 0.04840858, 0.04813641, 0.05086764, 0.05167105, 0.04487036, 0.04364056, 0.04381456, 0.04624106)
ytm_results_bond_2 <- c(0.04962840 ,0.04888894, 0.04957558, 0.04978792 ,0.04968260, 0.04740734,0.04826698 ,0.04898183, 0.04985926 ,0.04958512, 0.04924862)
ytm_results_bond_3<-c(0.04418336 ,0.04451291, 0.04411433, 0.04288918 ,0.04212138, 0.04206000,0.04340437, 0.04481886 ,0.04486251 ,0.04496569, 0.04515267)
ytm_results_bond_4<-c( 0.03987363, 0.04036780, 0.04020875, 0.04026530, 0.03931460, 0.03954259,0.04046983 ,0.04202702, 0.04209134 ,0.04221599 ,0.04230025)
ytm_results_bond_5<-c(0.03690468 ,0.03745658, 0.03725217, 0.03722496, 0.03651511, 0.03675925,0.03754284, 0.03909653, 0.03919831 ,0.03935192 ,0.03922284)
ytm_results_bond_6<-c(0.03516981, 0.03576126, 0.03553197, 0.03559292 ,0.03493524, 0.03517300,0.03609462 ,0.03766520, 0.03772519 ,0.03786977, 0.03778198)
ytm_results_bond_7<-c( 0.03486944, 0.03535332, 0.03524677, 0.0349981, 0.0342115,0.03419902 ,0.03506539, 0.03665983, 0.0368167, 0.03692037,0.03666406)
ytm_results_bond_8<-c(0.03376291, 0.03426216 ,0.0341593, 0.03437916, 0.03361179,0.03360408 ,0.03448407, 0.03605891, 0.03627013, 0.03614084, 0.03583177)
ytm_results_bond_9<-c(0.03308006, 0.03364816, 0.03331507 ,0.03353629, 0.03282015,0.03280074, 0.03368206 ,0.03527576, 0.0355007 ,0.03574624,0.03514695)
ytm_results_bond_10<-c(0.03225343, 0.03280933, 0.03274575 ,0.03299131, 0.03225118,0.03226926 ,0.03306959 ,0.03468111, 0.03489403 ,0.03516246,0.03455106)
# Annual coupon rate
Coupon <- 4/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
  ytm_for_coupon_1 = ytm_results_bond_1[Price_index]
  ytm_for_coupon_2=ytm_results_bond_2[Price_index]
  ytm_for_coupon_3=ytm_results_bond_3[Price_index]
  ytm_for_coupon_4=ytm_results_bond_4[Price_index]
  
   ytm_for_coupon_5=ytm_results_bond_5[Price_index]
   ytm_for_coupon_6=ytm_results_bond_6[Price_index]
   ytm_for_coupon_7=ytm_results_bond_7[Price_index]
   ytm_for_coupon_8<-ytm_results_bond_8[Price_index]
   ytm_for_coupon_9<-ytm_results_bond_9[Price_index]
    ytm_for_coupon_10<-ytm_results_bond_10[Price_index]
   
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2<-calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4 <- calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_coupon_5<- calculate_time_years(current_date_specific, "2026-03-01")
   Time_years_coupon_6<- calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
  Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
   Time_years_coupon_9<-calculate_time_years(current_date_specific, "2028-03-01")
   Time_years_coupon_10<-calculate_time_years(current_date_specific, "2028-09-01")
   Time_years_maturity<-calculate_time_years(current_date_specific, "2029-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_1 * Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_2 * Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_3 * Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_4 * Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_5 * Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_6 * Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_7 * Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_8 * Time_years_coupon_8)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_9 * Time_years_coupon_9)+((Coupon * FaceValue) / 2 ) * exp(-ytm_for_coupon_10 * Time_years_coupon_10)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue) * exp(-r * Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
yield_solution_bond11<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2029-03-01")
  ytm<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(YTM = ytm, Time_Years_Maturity = Time_years_maturity)
})

```
Combining the YTM for the bonds for each day
```{r}
combined<-cbind(t(yield_solution_bond1),t(yield_solution_bond2),t(yield_solution_bond3),t(yield_solution_bond4),t(yield_solution_bond5),t(yield_solution_bond6),t(yield_solution_bond7),t(yield_solution_bond8),t(yield_solution_bond9),t(yield_solution_bond10),t(yield_solution_bond11))

day_1<-(combined[1,])
day_2<-(combined[2,])
day_3<-(combined[3,])
day_4<-(combined[4,])
day_5<-(combined[5,])
day_6<-(combined[6,])
day_7<-(combined[7,])
day_8<-(combined[8,])
day_9<-(combined[9,])
day_10<-(combined[10,])
day_11<-(combined[11,])

values<-function(day){
YTM_values <- day[seq(1, length(day), by = 2)]
Time_Years_values <- day[seq(2, length(day), by = 2)]
df<-data.frame(cbind(as.numeric(YTM_values),as.numeric(Time_Years_values)))
rownames(df)<-selected_bonds
colnames(df)<-c("YTM","Time")
return(df)}


```

```{r}
day_1<-values(day_1)
day_2<-values(day_2)
day_3<-values(day_3)
day_4<-values(day_4)

day_5<-values(day_5)

day_6<-values(day_6)
day_7<-values(day_7)
day_8<-values(day_8)
day_9<-values(day_9)
day_10<-values(day_10)
day_11<-values(day_11)

plot_df<-data.frame(day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11)



```

Generating the Plots
```{r}

  ytm_plot<-ggplot(data = plot_df)+
  geom_line(aes(x=Time,y=YTM,color='day_1'))+
  geom_line(aes(x=Time.1,y=YTM.1,color='day_2'))+
   geom_line(aes(x=Time.2,y=YTM.2,color="day_3"))+
 geom_line(aes(x=Time.3,y=YTM.3,color="day_4"))+
  geom_line(aes(x=Time.4,y=YTM.4,color="day_5"))+
   geom_line(aes(x=Time.5,y=YTM.5,color="day_6"))+
    geom_line(aes(x=Time.6,y=YTM.6,color="day_7"))+
     geom_line(aes(x=Time.7,y=YTM.7,color="day_8"))+
      geom_line(aes(x=Time.8,y=YTM.8,color="day_9"))+
       geom_line(aes(x=Time.9,y=YTM.9,color="day_10"))+
  geom_line(aes(x=Time.10,y=YTM.10,color="day_11"))+
  labs(title = "5 year Yield Curve",x="Time",y="Yield to Maturity ")
  
       
  
```

Calculation of Spot Rates

Bond_1
```{r}
Price <- final$`Canada, Government of... 2,25% 18/24`
current_date<-final$date
Coupon <- 2.25/100 #  annual coupon
FaceValue <- 100 # The face value of the bond
maturity_date <- as.Date("2024-03-01")


Time_years <- function(current_date, maturity_date) {
  as.numeric(difftime(maturity_date, current_date, units = "month")) / 12}
calculate_spot_rate <- function(Price, Coupon, FaceValue, current_date, maturity_date) {
  Time_years <- calculate_time_years(current_date, maturity_date)
  # Adjusting the calculation for semi-annual coupon payments
 spot <- (((FaceValue + (Coupon/2 * FaceValue)) / Price) ^ (1 / Time_years)) - 1
  # Return both the spot rate and the time to maturity
  return(list(spot_rate = spot, Time_Years_Maturity = Time_years))
}

# Assuming 'Price', 'Coupon', 'FaceValue', 'current_date', and 'maturity_date' are properly defined
spot_solution_bond1 <- calculate_spot_rate(Price, Coupon, FaceValue, current_date, maturity_date)


```
Bond_2
```{r}
Price <- final$`Canada, Government of... 1,5% 19/24`
current_date <- final$date


# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)

# Annual coupon rate
Coupon <- 1.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

# Modified bond price function
bond_price_function <- function(r, Price_index) {
  # Accessing global variables
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon = spot_results_bond_1[Price_index]
  
  Time_years_coupon <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_maturity <- calculate_time_years(current_date_specific, "2024-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon)^(Time_years_coupon)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}

# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond2<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2024-09-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})


```
Bond_3

```{r}
Price <- final$`Canada, Government of... 1,25% 19/25`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)

# Annual coupon rate
Coupon <- 1.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
  
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2025-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond3<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2025-03-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_4
```{r}
Price <- final$`Canada, Government of... 0,5% 20/25`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)


# Annual coupon rate
Coupon <- 0.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2025-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond4<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2025-09-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_5
```{r}
Price <- final$`Canada, Government of... 0,25% 20/26`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)


# Annual coupon rate
Coupon <- 0.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2026-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond5<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2026-03-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_6
```{r}
Price <- final$`Canada, Government of... 1% 21/26`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)


# Annual coupon rate
Coupon <- 1/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2026-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond6<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2026-09-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_7
```{r}
Price <- final$`Canada, Government of... 1,25% 21/27`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)
spot_results_bond_6<-c( 0.03579541 ,0.0364082 ,0.03617059, 0.03623375, 0.03555247 ,0.03579871 ,0.03675374, 0.0383833, 0.038445590,03859574 ,0.03850457)


# Annual coupon rate
Coupon <- 1.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  spot_for_coupon_6=spot_results_bond_6[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
    Time_years_coupon_6<-calculate_time_years(current_date_specific, "2026-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2027-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_6)^(Time_years_coupon_6)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond7<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2027-03-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond-8
```{r}
Price <- final$`Canada, Government of... 2,75% 22/27`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)
spot_results_bond_6<-c( 0.03579541 ,0.0364082 ,0.03617059, 0.03623375, 0.03555247 ,0.03579871 ,0.03675374, 0.0383833, 0.038445590,03859574 ,0.03850457)
spot_results_bond_7<-c( 0.03548416 ,0.03598531, 0.03587494, 0.03561739, 0.03480314 ,0.03479022, 0.03568708, 0.03733967 ,0.0375024, 0.03551692, 0.03734407)


# Annual coupon rate
Coupon <- 2.75/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  spot_for_coupon_6=spot_results_bond_6[Price_index] 
  spot_for_coupon_7=spot_results_bond_7[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
    Time_years_coupon_6<-calculate_time_years(current_date_specific, "2026-09-01")
    Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2027-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_6)^(Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_7)^(Time_years_coupon_7)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond8<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2027-09-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_9
```{r}
Price <- final$`Canada, Government of... 3,5% 22/28`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)
spot_results_bond_6<-c( 0.03579541 ,0.0364082 ,0.03617059, 0.03623375, 0.03555247 ,0.03579871 ,0.03675374, 0.0383833, 0.038445590,03859574 ,0.03850457)
spot_results_bond_7<-c( 0.03548416 ,0.03598531, 0.03587494, 0.03561739, 0.03480314 ,0.03479022, 0.03568708, 0.03733967 ,0.0375024, 0.03551692, 0.03734407)
spot_results_bond_8<-c( 0.03433871, 0.03485519, 0.03474876, 0.03497627, 0.03418243, 0.03417446, 0.03508485, 0.03671608, 0.03693505,0.03285107, 0.03648066)



# Annual coupon rate
Coupon <- 3.5/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  spot_for_coupon_6=spot_results_bond_6[Price_index] 
  spot_for_coupon_7=spot_results_bond_7[Price_index] 
   spot_for_coupon_8=spot_results_bond_8[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
    Time_years_coupon_6<-calculate_time_years(current_date_specific, "2026-09-01")
    Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
     Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2028-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_6)^(Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_7)^(Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_8)^(Time_years_coupon_8)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond9<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2028-03-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_10
```{r}
Price <- final$`Canada, Government of... 3,25% 23/28`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)
spot_results_bond_6<-c( 0.03579541 ,0.0364082 ,0.03617059, 0.03623375, 0.03555247 ,0.03579871 ,0.03675374, 0.0383833, 0.038445590,03859574 ,0.03850457)
spot_results_bond_7<-c( 0.03548416 ,0.03598531, 0.03587494, 0.03561739, 0.03480314 ,0.03479022, 0.03568708, 0.03733967 ,0.0375024, 0.03551692, 0.03734407)
spot_results_bond_8<-c( 0.03433871, 0.03485519, 0.03474876, 0.03497627, 0.03418243, 0.03417446, 0.03508485, 0.03671608, 0.03693505,0.03285107, 0.03648066)
spot_results_bond_9<-c( 0.03363223 ,0.03421951 ,0.03387514 ,0.03410385, 0.03336366 ,0.03334361 ,0.03425457 ,0.0359039, 0.03613691,0.03198858, 0.03577052)


# Annual coupon rate
Coupon <- 3.25/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  spot_for_coupon_6=spot_results_bond_6[Price_index] 
  spot_for_coupon_7=spot_results_bond_7[Price_index] 
   spot_for_coupon_8=spot_results_bond_8[Price_index]
   spot_for_coupon_9=spot_results_bond_9[Price_index]
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
    Time_years_coupon_6<-calculate_time_years(current_date_specific, "2026-09-01")
    Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
     Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
     Time_years_coupon_9<-calculate_time_years(current_date_specific, "2028-03-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2028-09-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_6)^(Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_7)^(Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_8)^(Time_years_coupon_8)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_9)^(Time_years_coupon_9)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond10<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2028-09-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})

```
Bond_11
```{r}
Price <- final$`Canada, Government of... 4% 23/29`
current_date <- final$date

# YTM results from the first bond
spot_results_bond_1 <- c(0.04864005, 0.04886497, 0.04909883 ,0.04979981 ,0.04951780, 0.05241546, 0.05327077, 0.04610695, 0.04482089, 0.04500913 ,0.04757930)
spot_results_bond_2 <- c(0.05087868, 0.05010197, 0.05082319, 0.05104633, 0.05093567,0.04854748, 0.04944916 ,0.05019962 ,0.05112142, 0.05083335,0.05047985)
spot_results_bond_3 <- c(0.04516969 ,0.0455141, 0.04509763, 0.04381844, 0.04301756,0.04295362, 0.04435628, 0.04583415, 0.04587981, 0.04598772,0.04618334)
spot_results_bond_4<-c(0.04068107, 0.04119554, 0.0410299, 0.04108877, 0.0400993,0.04033644, 0.04130168, 0.04292471, 0.04299178, 0.04312181,0.04320966)
spot_results_bond_5<-c( 0.03759404 ,0.03816685, 0.03795465 ,0.03792641, 0.03718991,0.03744315 ,0.0382564, 0.03987076, 0.03997661, 0.04013637, 0.04000212)
spot_results_bond_6<-c( 0.03579541 ,0.0364082 ,0.03617059, 0.03623375, 0.03555247 ,0.03579871 ,0.03675374, 0.0383833, 0.038445590,03859574 ,0.03850457)
spot_results_bond_7<-c( 0.03548416 ,0.03598531, 0.03587494, 0.03561739, 0.03480314 ,0.03479022, 0.03568708, 0.03733967 ,0.0375024, 0.03551692, 0.03734407)
spot_results_bond_8<-c( 0.03433871, 0.03485519, 0.03474876, 0.03497627, 0.03418243, 0.03417446, 0.03508485, 0.03671608, 0.03693505,0.03285107, 0.03648066)
spot_results_bond_9<-c( 0.03363223 ,0.03421951 ,0.03387514 ,0.03410385, 0.03336366 ,0.03334361 ,0.03425457 ,0.0359039, 0.03613691,0.03198858, 0.03577052)
spot_results_bond_10<-c(  0.03277757, 0.03335171, 0.03328603 ,0.03353973 ,0.03277527 ,0.03279394 ,0.03362063, 0.03528717, 0.03550756,0.0321455, 0.03515262)


# Annual coupon rate
Coupon <- 4/100
# Face value of the bond
FaceValue <- 100

# Function to calculate time in years between dates
calculate_time_years <- function(start_date, end_date) {
  as.numeric(difftime(as.Date(end_date), as.Date(start_date), units = "days")) / 365
}

bond_price_function <- function(r, Price_index) {
  current_price <- Price[Price_index]
  current_date_specific <- as.Date(current_date[Price_index])
  
 spot_for_coupon_1= spot_results_bond_1[Price_index]
 spot_for_coupon_2= spot_results_bond_2[Price_index]
 spot_for_coupon_3=spot_results_bond_3[Price_index] 
 spot_for_coupon_4=spot_results_bond_4[Price_index] 
  spot_for_coupon_5=spot_results_bond_5[Price_index] 
  spot_for_coupon_6=spot_results_bond_6[Price_index] 
  spot_for_coupon_7=spot_results_bond_7[Price_index] 
   spot_for_coupon_8=spot_results_bond_8[Price_index]
   spot_for_coupon_9=spot_results_bond_9[Price_index]
   spot_for_coupon_10=spot_results_bond_10[Price_index] 
  Time_years_coupon_1 <- calculate_time_years(current_date_specific, "2024-03-01")
  Time_years_coupon_2 <- calculate_time_years(current_date_specific, "2024-09-01")
  Time_years_coupon_3<-calculate_time_years(current_date_specific, "2025-03-01")
  Time_years_coupon_4<-calculate_time_years(current_date_specific, "2025-09-01")
   Time_years_coupon_5<-calculate_time_years(current_date_specific, "2026-03-01")
    Time_years_coupon_6<-calculate_time_years(current_date_specific, "2026-09-01")
    Time_years_coupon_7<-calculate_time_years(current_date_specific, "2027-03-01")
     Time_years_coupon_8<-calculate_time_years(current_date_specific, "2027-09-01")
     Time_years_coupon_9<-calculate_time_years(current_date_specific, "2028-03-01")
     Time_years_coupon_10<-calculate_time_years(current_date_specific, "2028-09-01")
  Time_years_maturity<-calculate_time_years(current_date_specific, "2029-03-01")
  
  pv_coupon <- ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_1)^(Time_years_coupon_1)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_2)^(Time_years_coupon_2)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_3)^(Time_years_coupon_3)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_4)^(Time_years_coupon_4)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_5)^(Time_years_coupon_5)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_6)^(Time_years_coupon_6)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_7)^(Time_years_coupon_7)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_8)^(Time_years_coupon_8)+((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_9)^(Time_years_coupon_9)+
    ((Coupon * FaceValue) / 2 ) /(1+spot_for_coupon_10)^(Time_years_coupon_10)
  pv_face_value_and_last_coupon <- ((Coupon * FaceValue) / 2 + FaceValue)/(1+r)^(Time_years_maturity)
  
  pv_total <- pv_coupon + pv_face_value_and_last_coupon - current_price
  
  return(pv_total)

}


# Iterating over each Price and corresponding current_date to calculate YTM
spot_solution_bond11<- sapply(1:length(Price), function(index) {
  Time_years_maturity <- calculate_time_years(as.Date(current_date[index]), "2029-03-01")
  spot<-uniroot(bond_price_function, lower = 0, upper = 1, Price_index = index)$root
   list(spot_rate = spot, Time_Years_Maturity = Time_years_maturity)
})
```
Combining the spot rates for each bond across 11 days
```{r}
combined_spot<-cbind(t(spot_solution_bond2),t(spot_solution_bond3),t(spot_solution_bond4),t(spot_solution_bond5),t(spot_solution_bond6),t(spot_solution_bond7),t(spot_solution_bond8),t(spot_solution_bond9),t(spot_solution_bond10),t(spot_solution_bond11))

day_1<-data.frame(spot_rates=spot_solution_bond1$spot_rate,Time=spot_solution_bond1$Time_Years_Maturity) 
day_2<-(combined_spot[2,])
day_3<-(combined_spot[3,])
day_4<-(combined_spot[4,])
day_5<-(combined_spot[5,])
day_6<-(combined_spot[6,])
day_7<-(combined_spot[7,])
day_8<-(combined_spot[8,])
day_9<-(combined_spot[9,])
day_10<-(combined_spot[10,])
day_11<-(combined_spot[11,])

values<-function(day){
spot_values <- day[seq(1, length(day), by = 2)]
Time_Years_values <- day[seq(2, length(day), by = 2)]
df<-data.frame(cbind(as.numeric(spot_values),as.numeric(Time_Years_values)))

colnames(df)<-c("spot_rates","Time")
return(df)}



day_2<-rbind(day_1[2,],values(day_2))
day_3<-rbind(day_1[3,],values(day_3))
day_4<-rbind(day_1[4,],values(day_4))

day_5<-rbind(day_1[5,],values(day_5))

day_6<-rbind(day_1[6,],values(day_6))
day_7<-rbind(day_1[7,],values(day_7))
day_8<-rbind(day_1[8,],values(day_8))
day_9<-rbind(day_1[9,],values(day_9))
day_10<-rbind(day_1[10,],values(day_10))
day_11<-rbind(day_1[11,],values(day_11)) 
day_1<-data.frame(spot_rate=c(0.04864005,0.05087868,0.04516969,0.04068107,0.03759404,0.03579541,0.03548416,0.03433871,0.03363223,0.03277757, 0.03253588),Time=c(0.1452055, 0.6493151,1.145205,1.649315,2.145205 ,2.649315,3.145205,3.649315 ,4.147945 ,4.652055,5.147945     ))
```

```{r}
plot_df_spot<-data.frame(day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11)


```
Generating the Plot

```{r}

spot_plot<-  ggplot(data = plot_df_spot)+
  geom_line(aes(x=Time,y=spot_rate,color='day_1'))+
  geom_line(aes(x=Time.1,y=spot_rates,color='day_2'))+
   geom_line(aes(x=Time.2,y=spot_rates.1,color="day_3"))+
 geom_line(aes(x=Time.3,y=spot_rates.2,color="day_4"))+
  geom_line(aes(x=Time.4,y=spot_rates.3,color="day_5"))+
   geom_line(aes(x=Time.5,y=spot_rates.4,color="day_6"))+
    geom_line(aes(x=Time.6,y=spot_rates.5,color="day_7"))+
     geom_line(aes(x=Time.7,y=spot_rates.6,color="day_8"))+
      geom_line(aes(x=Time.8,y=spot_rates.7,color="day_9"))+
       geom_line(aes(x=Time.9,y=spot_rates.8,color="day_10"))+
  geom_line(aes(x=Time.10,y=spot_rates.9,color="day_11"))+
  labs(title = "5 year Spot Rate Curve",x="Time",y="Spot Rates ")
  
       
  
```

Calculation of Forward Rates

```{r}

rownames(plot_df_spot)<-1:nrow(plot_df_spot)
calculate_forward_rate<-function(spot_rate_1,spot_rate_2,t,t_hat){
  forward<-(((1+spot_rate_2)^2*(t_hat)/(1+spot_rate_1)^2*t)^2*(1/(t_hat-t)))-1
  return(forward)
}
```


```{r}
F11<-calculate_forward_rate(plot_df_spot$spot_rate[3],plot_df_spot$spot_rate[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rate[3],plot_df_spot$spot_rate[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rate[3],plot_df_spot$spot_rate[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rate[3],plot_df_spot$spot_rate[11],t=1,t_hat=5)



day_1_f<-data.frame(rates_d1=c(F11,F12,F13,F14),time=c(1,2,3,4))

F11<-calculate_forward_rate(plot_df_spot$spot_rates[3],plot_df_spot$spot_rates[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates[3],plot_df_spot$spot_rates[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates[3],plot_df_spot$spot_rates[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates[3],plot_df_spot$spot_rates[11],t=1,t_hat=5)

day_2_f<-data.frame(rates_d2=c(F11,F12,F13,F14))


F11<-calculate_forward_rate(plot_df_spot$spot_rates.1[3],plot_df_spot$spot_rates.1[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.1[3],plot_df_spot$spot_rates.1[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.1[3],plot_df_spot$spot_rates.1[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.1[3],plot_df_spot$spot_rates.1[11],t=1,t_hat=5)


day_3_f<-data.frame(rates_d3=c(F11,F12,F13,F14))
F11<-calculate_forward_rate(plot_df_spot$spot_rates.2[3],plot_df_spot$spot_rates.2[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.2[3],plot_df_spot$spot_rates.2[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.2[3],plot_df_spot$spot_rates.2[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.2[3],plot_df_spot$spot_rates.2[11],t=1,t_hat=5)
day_4_f<-data.frame(rates_d4=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.3[3],plot_df_spot$spot_rates.3[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.3[3],plot_df_spot$spot_rates.3[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.3[3],plot_df_spot$spot_rates.3[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.3[3],plot_df_spot$spot_rates.3[11],t=1,t_hat=5)
day_5_f<-data.frame(rates_d5=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.4[3],plot_df_spot$spot_rates.4[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.4[3],plot_df_spot$spot_rates.4[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.4[3],plot_df_spot$spot_rates.4[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.4[3],plot_df_spot$spot_rates.4[11],t=1,t_hat=5)
day_6_f<-data.frame(rates_d6=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.5[3],plot_df_spot$spot_rates.5[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.5[3],plot_df_spot$spot_rates.5[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.5[3],plot_df_spot$spot_rates.5[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.5[3],plot_df_spot$spot_rates.5[11],t=1,t_hat=5)
day_7_f<-data.frame(rates_d7=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.6[3],plot_df_spot$spot_rates.6[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.6[3],plot_df_spot$spot_rates.6[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.6[3],plot_df_spot$spot_rates.6[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.6[3],plot_df_spot$spot_rates.6[11],t=1,t_hat=5)
day_8_f<-data.frame(rates_d8=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.7[3],plot_df_spot$spot_rates.7[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.7[3],plot_df_spot$spot_rates.7[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.7[3],plot_df_spot$spot_rates.7[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.7[3],plot_df_spot$spot_rates.7[11],t=1,t_hat=5)
day_9_f<-data.frame(rates_d9=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.8[3],plot_df_spot$spot_rates.8[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.8[3],plot_df_spot$spot_rates.8[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.8[3],plot_df_spot$spot_rates.8[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.8[3],plot_df_spot$spot_rates.8[11],t=1,t_hat=5)
day_10_f<-data.frame(rates_d10=c(F11,F12,F13,F14))

F11<-calculate_forward_rate(plot_df_spot$spot_rates.9[3],plot_df_spot$spot_rates.9[5],t=1,t_hat=2)
F12<-calculate_forward_rate(plot_df_spot$spot_rates.9[3],plot_df_spot$spot_rates.9[7],t=1,t_hat=3)
F13<-calculate_forward_rate(plot_df_spot$spot_rates.9[3],plot_df_spot$spot_rates.9[9],t=1,t_hat=4)
F14<-calculate_forward_rate(plot_df_spot$spot_rates.9[3],plot_df_spot$spot_rates.9[11],t=1,t_hat=5)
day_11_f<-data.frame(rates_d11=c(F11,F12,F13,F14))

fwd_rates<-data.frame(day_1_f,day_2_f,day_3_f,day_4_f,day_5_f,day_6_f,day_7_f,day_8_f,day_9_f,day_10_f,day_11_f)


fwd_rates

```


```{r}
plot_fwd<-ggplot(data = fwd_rates)+
  geom_line(aes(x=time,y=rates_d1,color="day1"))+
  geom_line(aes(x=time,y=rates_d2,color="day2"))+
   geom_line(aes(x=time,y=rates_d3,color="day3"))+
   geom_line(aes(x=time,y=rates_d4,color="day4"))+
   geom_line(aes(x=time,y=rates_d2,color="day5"))+
   geom_line(aes(x=time,y=rates_d2,color="day6"))+
   geom_line(aes(x=time,y=rates_d2,color="day7"))+
   geom_line(aes(x=time,y=rates_d2,color="day8"))+
   geom_line(aes(x=time,y=rates_d2,color="day9"))+
   geom_line(aes(x=time,y=rates_d2,color="day10"))+
   geom_line(aes(x=time,y=rates_d2,color="day11"))+
  labs(title = "Forward Rate Curve", x="Time",y="Spot Rates")
```


Covariance Matrix

```{r}
df_yield<-plot_df|>
  select(starts_with("YTM"))|>
  remove_rownames()|>
  mutate(Bond=selected_bonds)|>
  pivot_longer(cols=-Bond)|>
  pivot_wider(names_from = Bond, values_from = value)|>
  select(-name)

log_returns_B1<-diff(log(df_yield$`Canada, Government of... 2,25% 18/24`))
log_returns_B2<-diff(log(df_yield$`Canada, Government of... 1,5% 19/24`))
log_returns_B3<-diff(log(df_yield$`Canada, Government of... 1,25% 19/25`))
log_returns_B4<-diff(log(df_yield$`Canada, Government of... 0,5% 20/25`))
log_returns_B5<-diff(log(df_yield$`Canada, Government of... 0,25% 20/26`))
log_returns_B6<-diff(log(df_yield$`Canada, Government of... 1% 21/26`))
log_returns_B7<-diff(log(df_yield$`Canada, Government of... 1,25% 21/27`))
log_returns_B8<-diff(log(df_yield$`Canada, Government of... 2,75% 22/27`))
log_returns_B9<-diff(log(df_yield$`Canada, Government of... 3,5% 22/28`))
log_returns_B10<-diff(log(df_yield$`Canada, Government of... 3,25% 23/28`))
log_returns_B11<-diff(log(df_yield$`Canada, Government of... 4% 23/29`))
  
log_returns_df<-data.frame(log_returns_B1,log_returns_B2,log_returns_B3,log_returns_B4,log_returns_B5,log_returns_B6,log_returns_B7,log_returns_B8,log_returns_B9,log_returns_B10,log_returns_B11)

```

```{r}
cov_matrix_yield <- cov(log_returns_df)
head(cov_matrix_yield)
```
```{r}
transposed_fwd<-fwd_rates|>
  select(starts_with("rates"))|>
  mutate(Time=c("F11","F12","F13","F14"))|>
  pivot_longer(cols = -Time)|>
  pivot_wider(names_from = "Time",values_from = "value")|>
  select(-name)

```

```{r}

log_returns_F11<-diff(log(transposed_fwd$F11))
log_returns_F12<-diff(log(transposed_fwd$F12))
log_returns_F13<-diff(log(transposed_fwd$F13))
log_returns_F14<-diff(log(transposed_fwd$F14))

log_returns_fwd_df<-data.frame(log_returns_F11,log_returns_F12,log_returns_F13,log_returns_F14)

```

```{r}
cov_matrix_fwd <- cov(log_returns_fwd_df)
head(cov_matrix_fwd)
```

Getting the Eigen Values and the Eigen Vectors of the covariance matrix of Yield to Maturities

```{r}
eigen_ytm<-eigen(cov_matrix_yield)
eigen_fwd<-eigen(cov_matrix_fwd)

eigen_ytm
eigen_fwd

```











